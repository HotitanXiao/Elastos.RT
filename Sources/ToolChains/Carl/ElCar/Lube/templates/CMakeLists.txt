
file(GLOB_RECURSE ALL_LUBE_FILES ${CMAKE_CURRENT_SOURCE_DIR}/*.lub)

add_custom_command(
    COMMENT "Compiling lube.lub..."
    OUTPUT "${CMAKE_CURRENT_BINARY_DIR}/lube.lbo"
           "${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/lube.lbo"
    COMMAND ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/lubc -I${CMAKE_CURRENT_SOURCE_DIR} -o lube.lbo ${CMAKE_CURRENT_SOURCE_DIR}/lube.lub
    COMMAND ${CMAKE_COMMAND} -E copy lube.lbo "${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/lube.lbo"
    WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
    DEPENDS ${ALL_LUBE_FILES} ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/lubc
)

add_custom_target(lube_templates ALL DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/lube.lbo)

